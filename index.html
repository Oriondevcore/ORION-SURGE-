<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#22d3ee">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Orion Surge">
  <title>ORION SURGE</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/png" href="/logo-192.png">
  <link rel="apple-touch-icon" href="/logo-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; overflow: hidden; height: 100vh; }
    * { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="importmap">
  {
    "imports": {
      "react": "https://esm.sh/react@18.2.0",
      "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
      "lucide-react": "https://esm.sh/lucide-react@0.263.1"
    }
  }
  </script>
  
  <script type="module">
import React, { useState, useEffect, useRef } from 'react';
import { createRoot } from 'react-dom/client';
import { Zap, Trophy, Settings, ShoppingCart, Crown, Users } from 'lucide-react';

const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzSEX8gDgWW-MlTwu6btUg_qeqO2CeiR7T4BS_YS8Xz7qFh2BCQUqSFQhclWR_tUy97/exec';

const OrionSurge = () => {
  const [gameState, setGameState] = useState('BETTING');
  const [multiplier, setMultiplier] = useState(1.00);
  const [countdown, setCountdown] = useState(10);
  const [crashPoint, setCrashPoint] = useState(null);
  const [roundId, setRoundId] = useState(1);
  const [username, setUsername] = useState('');
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [balance, setBalance] = useState(1000);
  const [betAmount1, setBetAmount1] = useState(100);
  const [betAmount2, setBetAmount2] = useState(40);
  const [activeBet1, setActiveBet1] = useState(null);
  const [activeBet2, setActiveBet2] = useState(null);
  const [autoCashout1, setAutoCashout1] = useState(null);
  const [autoCashout2, setAutoCashout2] = useState(null);
  const [recentCrashes, setRecentCrashes] = useState([]);
  const [showSettings, setShowSettings] = useState(false);
  const [showShop, setShowShop] = useState(false);
  const [showLeaderboard, setShowLeaderboard] = useState(false);
  const [leaderboard, setLeaderboard] = useState([]);
  const [activePlayers] = useState(12);
  const startTimeRef = useRef(null);

  const speak = (text) => {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 1.2;
      utterance.pitch = 1.0;
      utterance.volume = 0.8;
      window.speechSynthesis.speak(utterance);
    }
  };

  const generateCrashPoint = () => {
    const random = Math.random();
    const result = Math.floor((99) / (1 - random)) / 100;
    return Math.max(1.05, Math.min(100.00, result));
  };

  const calculateMultiplier = (elapsed) => {
    // Tiered speed system
    let mult = 1.00;
    let time = elapsed;
    
    // Tier 1: 1.00 to 3.00 at 40% speed
    if (mult < 3.00) {
      const tier1Time = Math.min(time, 10); // ~10 seconds to reach 3x
      mult += (tier1Time / 10) * 2 * 0.4;
      time -= tier1Time;
    }
    
    // Tier 2: 3.00 to 9.00 at 60% speed
    if (mult >= 3.00 && mult < 9.00 && time > 0) {
      const tier2Time = Math.min(time, 8);
      mult += (tier2Time / 8) * 6 * 0.6;
      time -= tier2Time;
    }
    
    // Tier 3: 9.00 to 15.00 at 80% speed
    if (mult >= 9.00 && mult < 15.00 && time > 0) {
      const tier3Time = Math.min(time, 6);
      mult += (tier3Time / 6) * 6 * 0.8;
      time -= tier3Time;
    }
    
    // Tier 4: 15.00+ at 100% speed (exponential)
    if (mult >= 15.00 && time > 0) {
      mult = 15.00 + Math.pow(1.15, time) - 1;
    }
    
    return Math.round(mult * 100) / 100;
  };

  const placeBet = (slot) => {
    if (gameState !== 'BETTING') return;
    const amount = slot === 1 ? betAmount1 : betAmount2;
    if (amount < 40 || amount > 2000 || amount > balance) return;
    
    setBalance(prev => prev - amount);
    if (slot === 1) setActiveBet1({ amount, cashedOut: false });
    else setActiveBet2({ amount, cashedOut: false });
  };

  const cashOut = (slot) => {
    if (gameState !== 'PLAYING') return;
    const bet = slot === 1 ? activeBet1 : activeBet2;
    if (!bet || bet.cashedOut) return;
    
    const winAmount = Math.floor(bet.amount * multiplier);
    setBalance(prev => prev + winAmount);
    
    if (slot === 1) setActiveBet1(prev => ({ ...prev, cashedOut: true, cashoutMultiplier: multiplier, winAmount }));
    else setActiveBet2(prev => ({ ...prev, cashedOut: true, cashoutMultiplier: multiplier, winAmount }));
  };

  useEffect(() => {
    if (gameState === 'PLAYING') {
      if (activeBet1 && !activeBet1.cashedOut && autoCashout1 && multiplier >= autoCashout1) cashOut(1);
      if (activeBet2 && !activeBet2.cashedOut && autoCashout2 && multiplier >= autoCashout2) cashOut(2);
    }
  }, [multiplier, gameState]);

  useEffect(() => {
    let interval;
    if (gameState === 'BETTING') {
      interval = setInterval(() => {
        setCountdown(prev => {
          if (prev <= 1) {
            setCrashPoint(generateCrashPoint());
            setGameState('PLAYING');
            setMultiplier(1.00);
            startTimeRef.current = Date.now();
            speak('Go!');
            return 10;
          }
          if (prev <= 3) speak(prev.toString());
          return prev - 1;
        });
      }, 1000);
    } else if (gameState === 'PLAYING') {
      interval = setInterval(() => {
        const elapsed = (Date.now() - startTimeRef.current) / 1000;
        const newMultiplier = calculateMultiplier(elapsed);
        setMultiplier(newMultiplier);
        
        if (newMultiplier >= crashPoint || newMultiplier >= 100) {
          setGameState('CRASHED');
          speak('Crashed!');
          
          setTimeout(() => {
            setRecentCrashes(prev => [crashPoint, ...prev.slice(0, 9)]);
            setTimeout(() => {
              setActiveBet1(null);
              setActiveBet2(null);
              setRoundId(prev => prev + 1);
              setCountdown(10);
              setGameState('BETTING');
            }, 2000);
          }, 1000);
        }
      }, 50);
    }
    return () => clearInterval(interval);
  }, [gameState, roundId, crashPoint]);

  if (!isLoggedIn) {
    return React.createElement('div', {className: "h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4"},
      React.createElement('div', {className: "bg-slate-800/50 backdrop-blur-xl border-2 border-blue-500/30 rounded-2xl p-6 w-full max-w-sm"},
        React.createElement('div', {className: "text-center mb-6"},
          React.createElement(Zap, {className: "w-20 h-20 text-cyan-400 mx-auto mb-3 animate-pulse", style: {filter: 'drop-shadow(0 0 20px rgba(34,211,238,0.8))'}}),
          React.createElement('h1', {className: "text-3xl font-bold text-white mb-1"}, "ORION SURGE"),
          React.createElement('p', {className: "text-cyan-400 text-xs font-semibold"}, "AI AMPLIFIES. I CREATE.")
        ),
        React.createElement('input', {
          type: "text",
          placeholder: "Enter Username",
          value: username,
          onChange: (e) => setUsername(e.target.value),
          onKeyPress: (e) => e.key === 'Enter' && username.trim() && setIsLoggedIn(true),
          className: "w-full px-4 py-2.5 mb-3 bg-slate-900/50 border border-blue-500/30 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-cyan-400 text-sm"
        }),
        React.createElement('button', {
          onClick: () => username.trim() && setIsLoggedIn(true),
          className: "w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold py-2.5 rounded-lg text-sm"
        }, "START PLAYING"),
        React.createElement('p', {className: "text-xs text-slate-400 text-center mt-3"}, "Starting balance: 1,000 tokens ðŸª™")
      )
    );
  }

  return React.createElement('div', {className: "h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white flex flex-col overflow-hidden"},
    
    // Top Bar
    React.createElement('div', {className: "bg-slate-900/80 border-b border-blue-500/30 px-3 py-2 flex-shrink-0"},
      React.createElement('div', {className: "flex items-center justify-between"},
        React.createElement('div', {className: "flex items-center gap-2"},
          React.createElement(Zap, {className: "w-6 h-6 text-cyan-400"}),
          React.createElement('div', null,
            React.createElement('h1', {className: "text-sm font-bold"}, "ORION SURGE"),
            React.createElement('p', {className: "text-xs text-slate-400"}, `Round #${roundId}`)
          )
        ),
        React.createElement('div', {className: "flex items-center gap-2"},
          React.createElement('div', {className: "flex items-center gap-1 bg-slate-800 px-2 py-1 rounded text-xs"},
            React.createElement(Users, {className: "w-3 h-3 text-green-400"}),
            React.createElement('span', null, activePlayers)
          ),
          React.createElement('div', {className: "text-right mr-2"},
            React.createElement('p', {className: "text-xs text-yellow-400 font-bold"}, `${balance.toFixed(0)} ðŸª™`)
          ),
          React.createElement('button', {onClick: () => setShowShop(true), className: "p-1.5 hover:bg-slate-800 rounded"}, 
            React.createElement(ShoppingCart, {className: "w-4 h-4 text-green-400"})
          ),
          React.createElement('button', {onClick: () => setShowLeaderboard(true), className: "p-1.5 hover:bg-slate-800 rounded"}, 
            React.createElement(Crown, {className: "w-4 h-4 text-yellow-400"})
          ),
          React.createElement('button', {onClick: () => setShowSettings(true), className: "p-1.5 hover:bg-slate-800 rounded"}, 
            React.createElement(Settings, {className: "w-4 h-4"})
          )
        )
      )
    ),

    // Recent Crashes
    React.createElement('div', {className: "bg-slate-800/30 px-3 py-1.5 border-b border-slate-700/50 flex-shrink-0 overflow-x-auto"},
      React.createElement('div', {className: "flex gap-1.5 items-center"},
        recentCrashes.length === 0 ? 
          React.createElement('span', {className: "text-xs text-slate-500"}, "No history...")
        : recentCrashes.map((crash, idx) =>
          React.createElement('span', {
            key: idx,
            className: `text-xs font-bold px-2 py-0.5 rounded whitespace-nowrap ${crash < 2 ? 'bg-red-500/20 text-red-400' : crash < 10 ? 'bg-yellow-500/20 text-yellow-400' : 'bg-green-500/20 text-green-400'}`
          }, `${crash.toFixed(2)}x`)
        )
      )
    ),

    // Main Game Area
    React.createElement('div', {className: "flex-1 flex flex-col p-3 overflow-hidden"},
      React.createElement('div', {className: "bg-slate-800/50 border-2 border-blue-500/30 rounded-xl flex-1 relative flex flex-col items-center justify-center mb-3 overflow-hidden"},
        gameState === 'BETTING' && React.createElement('div', {className: "text-center"},
          React.createElement(Zap, {className: "w-24 h-24 text-cyan-400 mx-auto mb-4 animate-pulse", style: {filter: 'drop-shadow(0 0 25px rgba(34,211,238,0.8))'}}),
          React.createElement('h2', {className: "text-3xl font-bold text-cyan-400 mb-2 animate-pulse"}, "PLACE BETS"),
          React.createElement('div', {className: "text-6xl font-bold text-yellow-400"}, countdown),
          React.createElement('p', {className: "text-slate-400 text-sm mt-2"}, "Next round...")
        ),
        
        (gameState === 'PLAYING' || gameState === 'CRASHED') && React.createElement('div', {className: "text-center w-full"},
          React.createElement(Zap, {
            className: `w-32 h-32 mx-auto mb-4 ${gameState === 'CRASHED' ? 'text-red-500 animate-ping' : 'text-cyan-400'}`,
            style: {filter: `drop-shadow(0 0 ${Math.min(multiplier * 4, 40)}px rgba(34,211,238,0.8))`, transform: `scale(${Math.min(1 + (multiplier - 1) * 0.05, 1.5)})`}
          }),
          React.createElement('div', {
            className: `text-7xl font-bold mb-2 ${gameState === 'CRASHED' ? 'text-red-500' : 'text-yellow-400'}`,
            style: {textShadow: `0 0 ${Math.min(multiplier * 2, 30)}px currentColor`}
          }, `${multiplier.toFixed(2)}x`),
          
          gameState === 'CRASHED' && React.createElement('div', {className: "text-xl font-bold text-red-400 animate-pulse mb-2"}, "ðŸ’¥ CRASHED!"),
          
          React.createElement('div', {className: "mt-3 space-y-1.5 px-3 w-full"},
            activeBet1 && React.createElement('div', {className: `px-3 py-2 rounded-lg text-sm ${activeBet1.cashedOut ? 'bg-green-500/20 text-green-400' : 'bg-blue-500/20 text-white'}`},
              React.createElement('p', {className: "font-bold text-xs"},
                activeBet1.cashedOut ? `Slot 1: ${activeBet1.winAmount} at ${activeBet1.cashoutMultiplier.toFixed(2)}x ðŸŽ‰` : `Slot 1: ${activeBet1.amount} â†’ ${Math.floor(activeBet1.amount * multiplier)}`
              )
            ),
            activeBet2 && React.createElement('div', {className: `px-3 py-2 rounded-lg text-sm ${activeBet2.cashedOut ? 'bg-green-500/20 text-green-400' : 'bg-blue-500/20 text-white'}`},
              React.createElement('p', {className: "font-bold text-xs"},
                activeBet2.cashedOut ? `Slot 2: ${activeBet2.winAmount} at ${activeBet2.cashoutMultiplier.toFixed(2)}x ðŸŽ‰` : `Slot 2: ${activeBet2.amount} â†’ ${Math.floor(activeBet2.amount * multiplier)}`
              )
            )
          )
        ),
        
        gameState === 'CRASHED' && React.createElement('div', {className: "absolute top-2 right-2 bg-red-500/20 border border-red-500 rounded px-2 py-1"},
          React.createElement('p', {className: "text-red-400 font-bold text-xs"}, `${crashPoint?.toFixed(2)}x`)
        )
      ),

      // Betting Controls - Side by Side
      React.createElement('div', {className: "grid grid-cols-2 gap-2 flex-shrink-0"},
        [1, 2].map(slot => {
          const betAmount = slot === 1 ? betAmount1 : betAmount2;
          const setBetAmount = slot === 1 ? setBetAmount1 : setBetAmount2;
          const activeBet = slot === 1 ? activeBet1 : activeBet2;
          const autoCashout = slot === 1 ? autoCashout1 : autoCashout2;
          const setAutoCashout = slot === 1 ? setAutoCashout1 : setAutoCashout2;
          
          return React.createElement('div', {key: slot, className: "bg-slate-800/50 border border-blue-500/30 rounded-lg p-2"},
            React.createElement('div', {className: "flex items-center gap-1 mb-2"},
              React.createElement('input', {
                type: "number",
                value: betAmount,
                onChange: (e) => setBetAmount(Math.max(40, Math.min(2000, parseInt(e.target.value) || 40))),
                disabled: gameState !== 'BETTING' || activeBet,
                className: "flex-1 px-2 py-1.5 bg-slate-900/50 border border-slate-700 rounded text-white text-sm disabled:opacity-50",
                min: "40",
                max: "2000"
              }),
              React.createElement('input', {
                type: "number",
                value: autoCashout || '',
                onChange: (e) => setAutoCashout(e.target.value ? parseFloat(e.target.value) : null),
                placeholder: "Auto",
                disabled: gameState !== 'BETTING' || activeBet,
                className: "w-14 px-1 py-1.5 bg-slate-900/50 border border-slate-700 rounded text-white text-xs placeholder-slate-600 disabled:opacity-50"
              })
            ),
            !activeBet ? 
              React.createElement('button', {
                onClick: () => placeBet(slot),
                disabled: gameState !== 'BETTING',
                className: "w-full bg-gradient-to-r from-green-600 to-green-500 disabled:from-slate-700 disabled:to-slate-600 text-white font-bold py-2.5 rounded-lg text-xs"
              }, gameState === 'BETTING' ? `BET ${betAmount}` : 'WAIT...')
            : !activeBet.cashedOut && gameState === 'PLAYING' ?
              React.createElement('button', {
                onClick: () => cashOut(slot),
                className: "w-full bg-gradient-to-r from-yellow-600 to-yellow-500 text-white font-bold py-2.5 rounded-lg text-xs animate-pulse"
              }, `CASH OUT ${Math.floor(activeBet.amount * multiplier)}`)
            :
              React.createElement('div', {className: "w-full bg-slate-700 text-slate-400 font-bold py-2.5 rounded-lg text-center text-xs"},
                activeBet.cashedOut ? 'âœ… OUT' : 'â³'
              )
          );
        })
      )
    ),

    // Modals
    showShop && React.createElement('div', {className: "fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50", onClick: () => setShowShop(false)},
      React.createElement('div', {className: "bg-slate-800 border-2 border-green-500/50 rounded-xl p-4 max-w-sm w-full", onClick: (e) => e.stopPropagation()},
        React.createElement('div', {className: "flex items-center justify-between mb-4"},
          React.createElement('h2', {className: "text-xl font-bold text-green-400 flex items-center gap-2"},
            React.createElement(ShoppingCart, {className: "w-5 h-5"}),
            "Token Shop"
          ),
          React.createElement('button', {onClick: () => setShowShop(false), className: "text-slate-400"}, "âœ•")
        ),
        React.createElement('div', {className: "space-y-2"},
          [
            {tokens: 1000, price: 50},
            {tokens: 2500, price: 100, popular: true},
            {tokens: 5000, price: 180},
            {tokens: 10000, price: 300}
          ].map(pkg => 
            React.createElement('button', {
              key: pkg.tokens,
              className: `w-full p-3 rounded-lg border-2 ${pkg.popular ? 'border-yellow-500 bg-yellow-500/10' : 'border-slate-600 bg-slate-700/50'}`
            },
              pkg.popular && React.createElement('div', {className: "text-xs text-yellow-400 font-bold mb-1"}, "ðŸ”¥ POPULAR"),
              React.createElement('div', {className: "flex justify-between items-center"},
                React.createElement('div', null,
                  React.createElement('p', {className: "text-lg font-bold text-white"}, `${pkg.tokens.toLocaleString()} ðŸª™`),
                  React.createElement('p', {className: "text-xs text-slate-400"}, `R${pkg.price}`)
                ),
                React.createElement('div', {className: "text-green-400 font-bold text-sm"}, "BUY")
              )
            )
          )
        )
      )
    ),

    showLeaderboard && React.createElement('div', {className: "fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50", onClick: () => setShowLeaderboard(false)},
      React.createElement('div', {className: "bg-slate-800 border-2 border-yellow-500/50 rounded-xl p-4 max-w-sm w-full max-h-[80vh] overflow-y-auto", onClick: (e) => e.stopPropagation()},
        React.createElement('div', {className: "flex items-center justify-between mb-4"},
          React.createElement('h2', {className: "text-xl font-bold text-yellow-400 flex items-center gap-2"},
            React.createElement(Crown, {className: "w-5 h-5"}),
            "Leaderboard"
          ),
          React.createElement('button', {onClick: () => setShowLeaderboard(false), className: "text-slate-400"}, "âœ•")
        ),
        React.createElement('p', {className: "text-center text-slate-400 py-8 text-sm"}, "Connect to see rankings")
      )
    ),

    showSettings && React.createElement('div', {className: "fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50", onClick: () => setShowSettings(false)},
      React.createElement('div', {className: "bg-slate-800 border-2 border-cyan-500/50 rounded-xl p-4 max-w-sm w-full", onClick: (e) => e.stopPropagation()},
        React.createElement('div', {className: "flex items-center justify-between mb-4"},
          React.createElement('h2', {className: "text-xl font-bold text-cyan-400"}, "Settings"),
          React.createElement('button', {onClick: () => setShowSettings(false), className: "text-slate-400"}, "âœ•")
        ),
        React.createElement('div', {className: "space-y-3"},
          React.createElement('div', null,
            React.createElement('h3', {className: "text-cyan-400 font-bold mb-1 text-sm"}, "Voice"),
            React.createElement('button', {
              onClick: () => speak("Test"),
              className: "w-full bg-blue-600 text-white py-2 rounded text-sm"
            }, "ðŸ”Š Test Voice")
          ),
          React.createElement('div', {className: "pt-3 border-t border-slate-700"},
            React.createElement('h3', {className: "text-cyan-400 font-bold mb-1 text-sm"}, "Contact"),
            React.createElement('p', {className: "text-xs text-slate-400"}, "graham@oriondevcore.com")
          ),
          React.createElement('button', {
            onClick: () => {
              if (confirm('Logout?')) {
                setIsLoggedIn(false);
                setBalance(1000);
                setRoundId(1);
              }
            },
            className: "w-full bg-red-600 text-white font-bold py-2 rounded text-sm"
          }, "Logout")
        )
      )
    )
  );
};

const root = createRoot(document.getElementById('root'));
root.render(React.createElement(OrionSurge));
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('SW registered:', reg.scope))
          .catch(err => console.log('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
